<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영어 단어 퀴즈</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #d6e0f5, #f5f9ff);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            width: 100%;
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: #7b68ee;
            text-decoration: none;
            margin-right: 30px;
        }

        #searchInput {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .header-right {
            display: flex;
            align-items: center;
        }

        .header-right a {
            text-decoration: none;
            margin-left: 15px;
            font-size: 0.95em;
            font-weight: 500;
            color: #555;
            transition: color 0.3s;
        }

        .header-right a:hover {
            color: #0076ff;
        }

        #studyPanel {
            display: none;
            position: absolute;
            top: calc(100% + 5px);
            right: 20px;
            width: 450px;
            background: #fff;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 20px;
            z-index: 100;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        #wrongAnswersPanel {
            display: none;
            position: absolute;
            top: calc(100% + 5px);
            right: 20px;
            width: 500px;
            background: #fff;
            border: 1px solid #e1e1e1;
            border-radius: 8px;
            padding: 20px;
            z-index: 100;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .panel h2 { 
            margin-bottom: 15px; 
            font-size: 1.2rem; 
            color: #333;
        }

        #studyContent {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: calc(100% - 12px);
            font-size: 1rem;
            resize: vertical;
            height: 120px;
            box-sizing: border-box;
        }

        #addStudyContentBtn {
            margin-top: 10px;
            padding: 8px 12px;
            background: #0076ff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1rem;
        }

        #addStudyContentBtn:hover { background: #005bb5; }

        #studyNotesList {
            margin-top: 20px;
            text-align: left;
            list-style: decimal inside;
            padding-left: 0;
        }

        #studyNotesList li {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #studyNotesList li button {
            background-color: #ff4d4f;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85em;
        }

        #studyNotesList li button:hover {
            background-color: #d9363e;
        }

        /* 오답노트 스타일 */
        #wrongAnswersList {
            margin-top: 15px;
            text-align: left;
            list-style: none;
            padding-left: 0;
            max-height: 300px;
            overflow-y: auto;
        }

        #wrongAnswersList li {
            background-color: #fff5f5;
            border: 1px solid #ffcdd2;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .wrong-answer-content {
            flex: 1;
        }

        .wrong-answer-word {
            font-weight: bold;
            font-size: 1.1em;
            color: #d32f2f;
            margin-bottom: 5px;
        }

        .wrong-answer-details {
            font-size: 0.9em;
            color: #666;
        }

        .wrong-answer-buttons {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .retry-btn {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .retry-btn:hover {
            background-color: #45a049;
        }

        .delete-wrong-btn {
            background-color: #ff4d4f;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .delete-wrong-btn:hover {
            background-color: #d9363e;
        }

        .clear-all-wrong-btn {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .clear-all-wrong-btn:hover {
            background-color: #f57c00;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .container h1 {
            margin-bottom: 20px;
            color: #0076ff;
        }

        .quiz-grid {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            gap: 30px;
            width: 100%;
            margin-top: 20px;
        }

        .refresh-btn {
            margin-bottom: 20px;
            padding: 10px 15px;
            background: #28a745;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1rem;
        }

        .refresh-btn:hover { background: #218838; }

        .my-quiz-container {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 450px;
            padding: 20px;
            box-sizing: border-box;
            margin: 0 auto;
        }

        .my-question-section {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            width: 100%;
        }

        .my-word-to-learn {
            text-align: center;
            width: 100%;
        }

        .my-word-to-learn h2 {
            font-size: 2.2em;
            color: #333;
            margin-top: 0;
            margin-bottom: 5px;
            text-transform: capitalize;
        }

        .my-word-to-learn .my-feedback {
            font-size: 1.1em;
            font-weight: bold;
            margin: 0;
            min-height: 1.2em;
        }

        .my-options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .my-option {
            background-color: #ffffff;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 15px;
            font-size: 1em;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .my-option:hover { background-color: #f8f9fa; }
        .my-option.selected { font-weight: bold; }
        
        .my-option.correct-answer {
            border-color: #28a745;
            background-color: #e6ffed;
            color: #28a745;
        }

        .my-option.incorrect-answer {
            border-color: #dc3545;
            background-color: #ffebee;
            color: #dc3545;
        }

        .my-option.correct-answer::before { content: '✓ '; font-weight: bold; }
        .my-option.incorrect-answer::before { content: '✗ '; font-weight: bold; }

        @media (max-width: 768px) {
            #searchInput { width: 150px; }
            .my-quiz-container { width: 90%; padding: 15px; }
            .my-word-to-learn h2 { font-size: 1.8em; }
            .my-option { padding: 12px; font-size: 0.9em; }
            #studyPanel, #wrongAnswersPanel { width: 90%; max-width: 400px; right: 5%; }
        }

        @media (max-width: 480px) {
            .header-container { flex-direction: column; align-items: flex-start; gap: 10px;}
            .header-right { width: 100%; justify-content: space-around; margin-top: 5px;}
            .header-right a { margin-left: 0;}
            .my-question-section { flex-direction: column; align-items: center; }
            .my-word-to-learn { text-align: center; }
            .my-word-to-learn h2 { font-size: 1.6em; }
            #studyPanel, #wrongAnswersPanel { width: calc(100% - 40px) ; right: 20px; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="header-left">
                <a href="#" class="logo">EduQuiz</a>
                <input type="text" id="searchInput" placeholder="검색 (영어 단어)">
            </div>
            <div class="header-right">
                <a href="#" id="homeLink">홈</a>
                <a href="#" id="studyNav">학습내용</a>
                <a href="#" id="wrongAnswersNav">오답노트</a>
            </div>
        </div>
        
        <!-- 학습내용 패널 -->
        <div id="studyPanel" class="panel">
            <h2>학습 내용 저장 및 추가</h2>
            <textarea id="studyContent" placeholder="학습한 내용을 입력하세요"></textarea><br>
            <button id="addStudyContentBtn">학습 내용 추가</button>
            <ul id="studyNotesList"></ul>
        </div>

        <!-- 오답노트 패널 -->
        <div id="wrongAnswersPanel" class="panel">
            <h2>오답노트 📝</h2>
            <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">틀린 문제들이 자동으로 저장됩니다.</p>
            <ul id="wrongAnswersList"></ul>
            <button id="clearAllWrongBtn" class="clear-all-wrong-btn">모든 오답 삭제</button>
        </div>
    </header>

    <div class="container">
        <h1>영어 단어 퀴즈</h1>
        <button class="refresh-btn" id="refreshBtn">새로운 문제</button>
        <div class="quiz-grid" id="quizGrid"></div>
    </div>

    <script>
        const baseWords = [
            { en: "apple", ko: "사과" }, { en: "book", ko: "책" }, { en: "car", ko: "자동차" },
            { en: "dog", ko: "개" }, { en: "house", ko: "집" }, { en: "tree", ko: "나무" },
            { en: "computer", ko: "컴퓨터" }, { en: "phone", ko: "전화기" }, { en: "river", ko: "강" },
            { en: "city", ko: "도시" }, { en: "happy", ko: "행복한" }, { en: "blue", ko: "파란" },
            { en: "bright", ko: "밝은" }, { en: "tall", ko: "키 큰" }, { en: "old", ko: "늙은/오래된" },
            { en: "young", ko: "젊은" }, { en: "smart", ko: "똑똑한" }, { en: "quiet", ko: "조용한" },
            { en: "loud", ko: "시끄러운" }, { en: "gentle", ko: "부드러운" }, { en: "water", ko: "물" },
            { en: "fire", ko: "불" }, { en: "earth", ko: "흙/지구" }, { en: "wind", ko: "바람" },
            { en: "sun", ko: "태양" }, { en: "moon", ko: "달" }, { en: "star", ko: "별" },
            { en: "sky", ko: "하늘" }, { en: "friend", ko: "친구" }, { en: "love", ko: "사랑" },
            { en: "time", ko: "시간" }, { en: "world", ko: "세계" }, { en: "school", ko: "학교" },
            { en: "student", ko: "학생" }, { en: "teacher", ko: "선생님" }, { en: "big", ko: "큰" },
            { en: "small", ko: "작은" }, { en: "fast", ko: "빠른" }, { en: "slow", ko: "느린" },
            { en: "beautiful", ko: "아름다운" }, { en: "strong", ko: "강한" }, { en: "weak", ko: "약한" },
            { en: "good", ko: "좋은" }, { en: "bad", ko: "나쁜" }, { en: "new", ko: "새로운" },
            { en: "red", ko: "빨간색" }, { en: "green", ko: "초록색" }, { en: "yellow", ko: "노란색" },
            { en: "white", ko: "흰색" }, { en: "black", ko: "검은색" }, { en: "day", ko: "낮/날" },
            { en: "night", ko: "밤" }, { en: "music", ko: "음악" }, { en: "food", ko: "음식" },
            { en: "game", ko: "게임" }, { en: "art", ko: "예술" }, { en: "flower", ko: "꽃" },
            { en: "mountain", ko: "산" }, { en: "ocean", ko: "바다" }, { en: "light", ko: "빛" },
            { en: "dark", ko: "어두운" }, { en: "hot", ko: "더운" }, { en: "cold", ko: "추운" },
            { en: "road", ko: "길" }, { en: "door", ko: "문" }, { en: "window", ko: "창문" },
            { en: "chair", ko: "의자" }, { en: "table", ko: "탁자" }, { en: "pen", ko: "펜" },
            { en: "pencil", ko: "연필" }, { en: "paper", ko: "종이" }, { en: "money", ko: "돈" },
            { en: "dream", ko: "꿈" }, { en: "work", ko: "일/작업" }, { en: "play", ko: "놀이/놀다" },
            { en: "walk", ko: "걷다" }, { en: "run", ko: "달리다" }, { en: "eat", ko: "먹다" },
            { en: "drink", ko: "마시다" }, { en: "sleep", ko: "자다" }, { en: "read", ko: "읽다" },
            { en: "write", ko: "쓰다" }, { en: "speak", ko: "말하다" }, { en: "listen", ko: "듣다" },
            { en: "think", ko: "생각하다" }, { en: "learn", ko: "배우다" }, { en: "teach", ko: "가르치다" },
            { en: "help", ko: "돕다" }, { en: "use", ko: "사용하다" }, { en: "make", ko: "만들다" },
            { en: "give", ko: "주다" }, { en: "take", ko: "가져가다" }, { en: "see", ko: "보다" },
            { en: "look", ko: "바라보다" }, { en: "find", ko: "찾다" }, { en: "know", ko: "알다" },
            { en: "feel", ko: "느끼다" }, { en: "come", ko: "오다" }, { en: "go", ko: "가다" },
            { en: "easy", ko: "쉬운" }, { en: "hard", ko: "어려운/단단한" }, { en: "kind", ko: "친절한" },
            { en: "rich", ko: "부유한" }, { en: "poor", ko: "가난한" }, { en: "always", ko: "항상" },
            { en: "never", ko: "결코 ~않다" }, { en: "often", ko: "자주" }, { en: "sometimes", ko: "때때로" }
        ];

        const wordPool = [];
        
        // 로컬 스토리지 키 상수
        const LOCAL_STORAGE_STUDY_NOTES_KEY = 'engVocabStudyNotes';
        const LOCAL_STORAGE_WRONG_ANSWERS_KEY = 'engVocabWrongAnswers';
        
        // DOM 요소 참조
        const studyNav = document.getElementById("studyNav");
        const studyPanel = document.getElementById("studyPanel");
        const studyContent = document.getElementById("studyContent");
        const addStudyContentBtn = document.getElementById("addStudyContentBtn");
        const studyNotesList = document.getElementById("studyNotesList");
        
        const wrongAnswersNav = document.getElementById("wrongAnswersNav");
        const wrongAnswersPanel = document.getElementById("wrongAnswersPanel");
        const wrongAnswersList = document.getElementById("wrongAnswersList");
        const clearAllWrongBtn = document.getElementById("clearAllWrongBtn");

        function populateWordPool(count = 200) {
            wordPool.length = 0;
            if (baseWords.length === 0) {
                console.error("기본 단어 목록이 비어있습니다!");
                return;
            }
            for (let i = 0; i < count; i++) {
                const randomIndex = Math.floor(Math.random() * baseWords.length);
                wordPool.push(baseWords[randomIndex]);
            }
        }

        function generateRandomEnglishQuizData() {
            if (wordPool.length === 0) {
                populateWordPool();
                if (wordPool.length === 0) {
                    return {
                        id: "error_quiz",
                        word: "Error",
                        choices: ["-", "-", "-", "-"],
                        answer: "-",
                        feedbackCorrect: "",
                        feedbackIncorrect: "단어 풀 로딩 실패"
                    };
                }
            }

            const chosenWordPair = wordPool[Math.floor(Math.random() * wordPool.length)];
            const englishWord = chosenWordPair.en;
            const correctKoreanMeaning = chosenWordPair.ko;

            let otherKoreanMeanings = baseWords
                .filter(pair => pair.ko !== correctKoreanMeaning)
                .map(pair => pair.ko);
            
            otherKoreanMeanings = [...new Set(otherKoreanMeanings)];
            otherKoreanMeanings.sort(() => Math.random() - 0.5);

            const choices = otherKoreanMeanings.slice(0, 3);
            choices.push(correctKoreanMeaning);
            choices.sort(() => Math.random() - 0.5);

            const finalUniqueChoices = [...new Set(choices)].slice(0, 4);
            while (finalUniqueChoices.length < 4 && baseWords.length >= 4) {
                const randomFallback = baseWords[Math.floor(Math.random() * baseWords.length)].ko;
                if (!finalUniqueChoices.includes(randomFallback)) {
                    finalUniqueChoices.push(randomFallback);
                }
            }

            return {
                id: `en_quiz_${Date.now()}_${Math.random().toString(16).slice(2)}`,
                word: englishWord,
                choices: finalUniqueChoices,
                answer: correctKoreanMeaning,
                feedbackCorrect: "정답입니다!",
                feedbackIncorrect: "오답입니다."
            };
        }

        // 특정 단어로 퀴즈 생성 (오답노트에서 재시도할 때 사용)
        function generateQuizFromWord(word, correctAnswer) {
            let otherKoreanMeanings = baseWords
                .filter(pair => pair.ko !== correctAnswer)
                .map(pair => pair.ko);
            
            otherKoreanMeanings = [...new Set(otherKoreanMeanings)];
            otherKoreanMeanings.sort(() => Math.random() - 0.5);

            const choices = otherKoreanMeanings.slice(0, 3);
            choices.push(correctAnswer);
            choices.sort(() => Math.random() - 0.5);

            return {
                id: `retry_quiz_${Date.now()}_${Math.random().toString(16).slice(2)}`,
                word: word,
                choices: choices,
                answer: correctAnswer,
                feedbackCorrect: "정답입니다!",
                feedbackIncorrect: "오답입니다."
            };
        }

        // 오답 저장 함수
        function saveWrongAnswer(word, correctAnswer, userAnswer) {
            const wrongAnswers = JSON.parse(localStorage.getItem(LOCAL_STORAGE_WRONG_ANSWERS_KEY)) || [];
            
            // 중복 체크 (같은 단어가 이미 있으면 업데이트)
            const existingIndex = wrongAnswers.findIndex(item => item.word === word);
            
            const wrongAnswerData = {
                word: word,
                correctAnswer: correctAnswer,
                userAnswer: userAnswer,
                timestamp: new Date().toLocaleDateString('ko-KR')
            };

            if (existingIndex !== -1) {
                wrongAnswers[existingIndex] = wrongAnswerData; // 기존 항목 업데이트
            } else {
                wrongAnswers.push(wrongAnswerData); // 새 항목 추가
            }

            localStorage.setItem(LOCAL_STORAGE_WRONG_ANSWERS_KEY, JSON.stringify(wrongAnswers));
        }

        // 오답노트 렌더링 함수
        function renderWrongAnswers() {
            wrongAnswersList.innerHTML = "";
            const wrongAnswers = JSON.parse(localStorage.getItem(LOCAL_STORAGE_WRONG_ANSWERS_KEY)) || [];
            
            if (wrongAnswers.length === 0) {
                const emptyMessage = document.createElement("li");
                emptyMessage.style.textAlign = "center";
                emptyMessage.style.color = "#999";
                emptyMessage.style.fontStyle = "italic";
                emptyMessage.style.border = "none";
                emptyMessage.style.background = "transparent";
                emptyMessage.textContent = "아직 틀린 문제가 없습니다! 🎉";
                wrongAnswersList.appendChild(emptyMessage);
                return;
            }

            wrongAnswers.forEach((item, index) => {
                const listItem = document.createElement("li");
                
                const contentDiv = document.createElement("div");
                contentDiv.className = "wrong-answer-content";
                
                const wordDiv = document.createElement("div");
                wordDiv.className = "wrong-answer-word";
                wordDiv.textContent = item.word;
                
                const detailsDiv = document.createElement("div");
                detailsDiv.className = "wrong-answer-details";
                detailsDiv.innerHTML = `
                    정답: <strong>${item.correctAnswer}</strong><br>
                    선택: <span style="color: #d32f2f;">${item.userAnswer}</span><br>
                    <small>날짜: ${item.timestamp}</small>
                `;
                
                contentDiv.appendChild(wordDiv);
                contentDiv.appendChild(detailsDiv);
                
                const buttonsDiv = document.createElement("div");
                buttonsDiv.className = "wrong-answer-buttons";
                
                const retryBtn = document.createElement("button");
                retryBtn.className = "retry-btn";
                retryBtn.textContent = "다시풀기";
                retryBtn.onclick = function() {
                    // 해당 단어로 새로운 퀴즈 생성
                    quizData = [generateQuizFromWord(item.word, item.correctAnswer)];
                    renderCards();
                    // 패널 닫기
                    wrongAnswersPanel.style.display = "none";
                };
                
                const deleteBtn = document.createElement("button");
                deleteBtn.className = "delete-wrong-btn";
                deleteBtn.textContent = "삭제";
                deleteBtn.onclick = function() {
                    deleteWrongAnswer(index);
                };
                
                buttonsDiv.appendChild(retryBtn);
                buttonsDiv.appendChild(deleteBtn);
                
                listItem.appendChild(contentDiv);
                listItem.appendChild(buttonsDiv);
                wrongAnswersList.appendChild(listItem);
            });
        }

        // 특정 오답 삭제 함수
        function deleteWrongAnswer(index) {
            let wrongAnswers = JSON.parse(localStorage.getItem(LOCAL_STORAGE_WRONG_ANSWERS_KEY)) || [];
            wrongAnswers.splice(index, 1);
            localStorage.setItem(LOCAL_STORAGE_WRONG_ANSWERS_KEY, JSON.stringify(wrongAnswers));
            renderWrongAnswers();
        }

        // 모든 오답 삭제 함수
        function clearAllWrongAnswers() {
            if (confirm("모든 오답을 삭제하시겠습니까?")) {
                localStorage.removeItem(LOCAL_STORAGE_WRONG_ANSWERS_KEY);
                renderWrongAnswers();
            }
        }

        function createMyQuizDOM(data) {
            const quizContainer = document.createElement('div');
            quizContainer.className = 'my-quiz-container';

            const questionSection = document.createElement('div');
            questionSection.className = 'my-question-section';

            const wordToLearnDiv = document.createElement('div');
            wordToLearnDiv.className = 'my-word-to-learn';
            const wordH2 = document.createElement('h2');
            wordH2.textContent = data.word;
            const feedbackP = document.createElement('p');
            feedbackP.className = 'my-feedback';
            feedbackP.textContent = "뜻을 선택하세요.";
            feedbackP.style.color = "#777";

            wordToLearnDiv.appendChild(wordH2);
            wordToLearnDiv.appendChild(feedbackP);

            questionSection.appendChild(wordToLearnDiv);
            quizContainer.appendChild(questionSection);

            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'my-options-container';
            
            data.choices.forEach(choiceText => {
                const optionButton = document.createElement('button');
                optionButton.className = 'my-option';
                optionButton.textContent = choiceText;

                optionButton.addEventListener('click', () => {
                    optionButton.classList.add('selected');
                    
                    if (choiceText === data.answer) {
                        optionButton.classList.add('correct-answer');
                        feedbackP.textContent = data.feedbackCorrect;
                        feedbackP.style.color = '#28a745';
                    } else {
                        optionButton.classList.add('incorrect-answer');
                        feedbackP.textContent = data.feedbackIncorrect;
                        feedbackP.style.color = '#dc3545';
                        
                        // 오답인 경우 오답노트에 저장
                        saveWrongAnswer(data.word, data.answer, choiceText);
                    }
                    
                    optionsContainer.querySelectorAll('.my-option').forEach(btn => {
                        btn.disabled = true;
                    });
                });
                optionsContainer.appendChild(optionButton);
            });
            quizContainer.appendChild(optionsContainer);
            return quizContainer;
        }

        let quizData = [generateRandomEnglishQuizData()];

        function renderCards() {
            const quizGrid = document.getElementById("quizGrid");
            quizGrid.innerHTML = "";
            if (quizData && quizData.length > 0 && quizData[0].word !== "Error") {
                const cardElement = createMyQuizDOM(quizData[0]);
                quizGrid.appendChild(cardElement);
            } else if (quizData[0] && quizData[0].word === "Error") {
                quizGrid.textContent = quizData[0].feedbackIncorrect || "퀴즈를 불러올 수 없습니다.";
            }
        }

        // 학습 내용 렌더링 함수
        function renderStudyNotes() {
            studyNotesList.innerHTML = "";
            const notes = JSON.parse(localStorage.getItem(LOCAL_STORAGE_STUDY_NOTES_KEY)) || [];
            notes.forEach((noteText, index) => {
                const listItem = document.createElement("li");
                
                const textSpan = document.createElement("span");
                textSpan.textContent = noteText;
                
                const deleteBtn = document.createElement("button");
                deleteBtn.textContent = "삭제";
                deleteBtn.onclick = function() {
                    deleteStudyNote(index);
                };

                listItem.appendChild(textSpan);
                listItem.appendChild(deleteBtn);
                studyNotesList.appendChild(listItem);
            });
        }

        // 학습 내용 삭제 함수
        function deleteStudyNote(noteIndex) {
            let notes = JSON.parse(localStorage.getItem(LOCAL_STORAGE_STUDY_NOTES_KEY)) || [];
            notes.splice(noteIndex, 1);
            localStorage.setItem(LOCAL_STORAGE_STUDY_NOTES_KEY, JSON.stringify(notes));
            renderStudyNotes();
        }

        // 패널 닫기 함수
        function closeAllPanels() {
            studyPanel.style.display = "none";
            wrongAnswersPanel.style.display = "none";
        }

        // 이벤트 리스너 설정
        document.getElementById("refreshBtn").addEventListener("click", () => {
            quizData = [generateRandomEnglishQuizData()];
            renderCards();
        });

        document.getElementById("searchInput").addEventListener("input", (e) => {
            const query = e.target.value.toLowerCase().trim();
            const currentQuizContainer = document.querySelector(".my-quiz-container");
            if (currentQuizContainer) {
                const wordElement = currentQuizContainer.querySelector(".my-word-to-learn h2");
                if (wordElement) {
                    const wordText = wordElement.textContent.toLowerCase();
                    if (query === "") {
                        currentQuizContainer.style.border = "";
                    } else if (wordText.includes(query)) {
                        currentQuizContainer.style.border = "2px solid gold";
                    } else {
                        currentQuizContainer.style.border = "2px solid transparent";
                    }
                }
            }
        });

        document.getElementById("homeLink").addEventListener("click", (e) => {
            e.preventDefault();
            window.location.reload();
        });

        // 학습 내용 패널 토글
        studyNav.addEventListener("click", (e) => {
            e.preventDefault();
            closeAllPanels();
            if (studyPanel.style.display !== "block") {
                studyPanel.style.display = "block";
                renderStudyNotes();
            }
        });

        // 오답노트 패널 토글
        wrongAnswersNav.addEventListener("click", (e) => {
            e.preventDefault();
            closeAllPanels();
            if (wrongAnswersPanel.style.display !== "block") {
                wrongAnswersPanel.style.display = "block";
                renderWrongAnswers();
            }
        });

        // 학습 내용 추가 버튼 이벤트 리스너
        addStudyContentBtn.addEventListener("click", () => {
            const noteText = studyContent.value.trim();
            if (noteText === "") {
                alert("학습 내용을 입력해주세요.");
                return;
            }

            const notes = JSON.parse(localStorage.getItem(LOCAL_STORAGE_STUDY_NOTES_KEY)) || [];
            notes.push(noteText);
            localStorage.setItem(LOCAL_STORAGE_STUDY_NOTES_KEY, JSON.stringify(notes));

            studyContent.value = "";
            renderStudyNotes();
        });

        // 모든 오답 삭제 버튼 이벤트 리스너
        clearAllWrongBtn.addEventListener("click", clearAllWrongAnswers);

        // 외부 클릭 시 패널 닫기
        document.addEventListener("click", (e) => {
            if (!studyPanel.contains(e.target) && !studyNav.contains(e.target) &&
                !wrongAnswersPanel.contains(e.target) && !wrongAnswersNav.contains(e.target)) {
                closeAllPanels();
            }
        });

        // 초기화
        populateWordPool(200);
        renderCards();
        renderStudyNotes();
        renderWrongAnswers();
    </script>
</body>
</html>